$(function(){$('.booking-widget').each(function(){let bw=new BookingWidget($(this));});});const BookingWidget=function(this$obj){this.$obj=this$obj;this.position=this.$obj.data('position');this.widgetType=this.$obj.data('type');this.init();};BookingWidget.prototype.init=function init(){this.toggleSticky();if(this.widgetType==='corporate'){this.hotel_check();this.hotel_picker();this.external_booking();}
this.accordionTriggers();this.litepicker_init(booking_config.opening_date!==null?new Date(booking_config.opening_date):new Date());this.number_counter();this.close_modal();this.booking_geolocation();};BookingWidget.prototype.toggleSticky=function toggleSticky(){let _this=this;this.$obj.each(function(){let target=$(this);let position=_this.$obj.data('position');$('.js-reserve-link').on('click',function(){if(position==='bw--sticky'){target.addClass('bw-active');target.find('.close-booking').focus();}});_this.$obj.find('.close-booking').on('click',function(){target.removeClass('bw-active');})});};BookingWidget.prototype.hotel_check=function hotel_check(){let $hotel_field=this.$obj.find('.js-bw-input-hotel');let $error_text=this.$obj.find('.submission-error');this.$obj.find('.booking-widget-form').submit(function(){if($hotel_field.val().length===0){$error_text.text('Please select a hotel before checking availability');$error_text.addClass('submission-error--active');return false;}});};BookingWidget.prototype.hotel_picker=function hotel_picker(){let _this=this;this.$obj.find('.nobu-hotel').each(function(){$(this).on('click',function(){let target=$(this);let hotel_date=target.find('.open-date').text();_this.$obj.find('.booking-widget-form').attr('action',target.data("engine"));$('.hotel-value').text(target.find('.hotel-name').text());_this.$obj.find('.js-bw-input-hotel').val(target.data("code"));_this.$obj.find('.js-bw-input-chain').val(target.data("chain"));_this.$obj.find('.js-bw-input-theme').val(target.data("theme"));let promo=target.data("promo");let rate=target.data("rate");if(promo!==''||rate!==''){if(promo!==''){_this.$obj.find('.booking-widget__promo').val(promo);}
if(rate!==''){_this.$obj.find('.booking-widget__rate').val(rate);}}
if(hotel_date!==''){_this.$obj.find('.bm-checkin').text(hotel_date);_this.$obj.find('.bm-checkout').text('');_this.$obj.find('.js-booking-widget-arrival').val(hotel_date).change();}
$('.booking-widget__accordion').removeClass('booking-widget__accordion--active');});});};BookingWidget.prototype.external_booking=function external_booking(){this.$obj.find('.nobu-hotel-external').each(function(){$(this).on('click',function(){let $external_url=$(this).data('engine');window.open($external_url,'_blank');$('.booking-widget__accordion').removeClass('booking-widget__accordion--active');});});};BookingWidget.prototype.accordionTriggers=function accordionTriggers(){let _this=this
this.$obj.find(".js-accordion-trigger").each(function(){$(this).on('click',function(){let $target=$(this).parent().children().last();$('.booking-widget__accordion--active').each(function(){$(this).removeClass('booking-widget__accordion--active');});$($target).addClass('booking-widget__accordion--active');if($($target).hasClass('date-accordion')){$('.litepicker').find('.button-previous-month').trigger('focus');}
_this.accordionClose($target);});})};BookingWidget.prototype.accordionClose=function accordionClose($target){$('body').on('click',function(e){if($(e.target).closest('.booking-widget').length===0){if($(e.target).closest('.month-item').length===0){$('.booking-widget__accordion--active').each(function(){$(this).removeClass('booking-widget__accordion--active');});}}});};BookingWidget.prototype.litepicker_init=function litepicker_init(today){let _this=this;let toDate=new Date(today);toDate.setDate(toDate.getDate()+1);let minDate=new Date(today);let lang=document.documentElement.lang;let calendarLang;if(today.toDateString()==(new Date()).toDateString()){minDate.setDate(minDate.getDate()-1);}
let width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;const pickerTriggers=this.$obj.find('.booking-widget__litepicker');for(let i=0;i<pickerTriggers.length;i++){let months=2;let columns=2;if($(pickerTriggers[i]).hasClass('single-picker')||width<768){months=1;columns=1;}
switch(lang){case'en':calendarLang='en-EN';break;case'fr':calendarLang='fr-FR';break;case'de':calendarLang='de-DE';break;case'pl':calendarLang='pl-PL';break;case'es':calendarLang='es-ES';break;default:calendarLang='en-EN';}
let modalpicker=new Litepicker({element:pickerTriggers[i],plugins:['keyboardnav'],inlineMode:true,firstDay:0,format:'YYYY MM DD',singleMode:false,numberOfMonths:months,numberOfColumns:columns,showTooltip:true,scrollToDate:true,keyboardnav:{firstTabIndex:2,},minDate:minDate,startDate:today,endDate:toDate,tooltipText:{one:'night',other:'nights'},lang:calendarLang,tooltipNumber:(totalDays)=>{return totalDays-1;},setup:(modalpicker)=>{modalpicker.on('before:show',(el)=>{_this.litepickerRendered(modalpicker);});modalpicker.on('selected',(startDate,endDate)=>{_this.litepickerSelected(startDate,endDate,modalpicker);});}});}};BookingWidget.prototype.litepickerSelected=function litepickerSelected(startDate,endDate,modalpicker){let _this=this;let lang=document.documentElement.lang;let days;switch(lang){case'fr':days=['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'];break;case'de':days=['Son','Mon','Die','Mit','Don','Fre','Sam'];break;case'pl':days=['Nd','Pn','Wt','Śr','Czw','Pt','Sb'];break;case'es':days=['Do','Lu','Ma','Mi','Ju','Vi','Sa'];break;default:days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];}
let weekdayStart=startDate.getDay();let weekdayEnd=endDate.getDay();this.$obj.find('.js-booking-widget-arrival')[0].setAttribute('value',startDate.format('YYYY-MM-DD'));this.$obj.find('.js-booking-widget-depart')[0].setAttribute('value',endDate.format('YYYY-MM-DD'));let hero=$('.booking-widget--hero');let sticky=$('.booking-widget--sticky');let content=$('.booking-widget--content');$(hero).find('.bm-checkin').html('<span class="value-small-text">TO<?span>');$(hero).find('.bm-checkin').prepend(days[weekdayStart]+startDate.format(', MMM DD'));$(hero).find('.bm-checkin').append(days[weekdayEnd]+endDate.format(', MMM DD'));$(sticky).find('.bm-checkin').text(days[weekdayStart]+startDate.format(', MMM DD'));$(content).find('.bm-checkin').text(days[weekdayStart]+startDate.format(', MMM DD'));$('.bm-checkout').text(days[weekdayEnd]+endDate.format(', MMM DD'));this.litepickerClose(modalpicker);};BookingWidget.prototype.litepickerRendered=function litepickerRendered(modalpicker,today){let checkDateValue=this.$obj.find('.js-booking-widget-arrival');checkDateValue.on('change',function(){if(checkDateValue!==''||checkDateValue!==null&&checkDateValue!==undefined){today=checkDateValue.val();let tomorrow=new Date(today);tomorrow.setDate(tomorrow.getDate()+2);modalpicker.setDateRange(today,tomorrow);modalpicker.gotoDate(today);}else{today=new Date();let tomorrow=new Date();tomorrow.setDate(tomorrow.getDate()+2);modalpicker.setDateRange(today,tomorrow);modalpicker.gotoDate(today);}});};BookingWidget.prototype.litepickerClose=function litepickerClose(modalpicker){let _this=this.$obj;$('.litepicker').each(function(){$(this).parent().removeClass('booking-widget__accordion--active');});this.$obj.find('.guest-trigger').trigger('focus');let guest_trigger=_this.find('.guest-trigger');guest_trigger.trigger('click');setTimeout(function(){guest_trigger.next().find('.bw-numberpicker__btn--sub').first().trigger('focus');},200);};BookingWidget.prototype.number_counter=function number_counter(){let _this=this;this.$obj.find('.bw-numberpicker').each(function(){let this$=$(this);let input_el_name=this$.data('input');let input_el=$('.'+input_el_name);let min_val=input_el.attr('min');let max_val=input_el.attr('max');let numberpicker_btn_add=this$.find('.bw-numberpicker__btn--add');let numberpicker_btn_sub=this$.find('.bw-numberpicker__btn--sub');numberpicker_btn_add.click($.proxy(function(){let display=this$.find('.bw-numberpicker__value');let value=parseInt(display.text());if(value+1<=max_val){display.text(value+1);_this.guest_update(this$);}},this));numberpicker_btn_sub.click($.proxy(function(){let display=this$.find('.bw-numberpicker__value');let value=parseInt(display.text());if(value-1>=min_val){display.text(value-1);_this.guest_update();}},this));});};BookingWidget.prototype.guest_update=function guest_update(){let input_adults_widget=this.$obj.find('.bw-numberpicker__value[data-id="js-gm-adults"]').text();let input_children_widget=this.$obj.find('.bw-numberpicker__value[data-id="js-gm-child"]').text();let input_rooms_widget=this.$obj.find('.bw-numberpicker__value[data-id="js-gm-rooms"]').text();this.$obj.find('.js-gm-input-adults').val(parseInt(input_adults_widget));this.$obj.find('.js-gm-input-child').val(parseInt(input_children_widget));this.$obj.find('.js-gm-input-rooms').val(parseInt(input_rooms_widget));let lang=document.documentElement.lang;let guests,guest,rooms,room;switch(lang){case'fr':guests='Invités';guest='Invité';rooms='Chambres';room='Chambre';break;case'de':guests='Gäste';guest='Gast';rooms='Zimmer';room='Zimmer';break;case'pl':guests='Goście';guest='Gość';rooms='Pokoje';room='Pokój';break;case'es':guests='Invitados';guest='Invitado';rooms='Alojamiento';room='Habitación';break;default:guests='Guests';guest='Guest';rooms='Rooms';room='Room';}
let guest_total=parseInt(input_adults_widget)+parseInt(input_children_widget);if(guest_total!==1){guest_total=guest_total+' '+guests;}else{guest_total=guest_total+' '+guest;}
input_rooms_widget=parseInt(input_rooms_widget);if(input_rooms_widget!==1){input_rooms_widget=input_rooms_widget+' '+rooms;}else{input_rooms_widget=input_rooms_widget+' '+room;}
$('.guest-value').each(function(){$(this).html('<span class="value-small-text">/</span>');$(this).prepend(input_rooms_widget);$(this).append(guest_total);})};BookingWidget.prototype.close_modal=function close_modal(){this.$obj.find('.close-booking').each(function(){$(this).on('click',function(){$('.booking-widget__accordion--active').each(function(){$(this).removeClass('booking-widget__accordion--active')});});$(this).on('keyup',function(event){if(event.keyCode===13){$('.booking-widget__accordion--active').each(function(){$(this).removeClass('booking-widget__accordion--active')});}});});};BookingWidget.prototype.booking_geolocation=function booking_geolocation(){let bookingConfig=this.$obj.find('.js-booking-config');let bookingConfigCode=this.$obj.find('.js-booking-configcode');let currencyCode=this.$obj.find('.js-booking-currency');let localeCode=this.$obj.find('.js-booking-locale');let themeCode=this.$obj.find('.js-bw-input-theme');let bookingThemeCode=this.$obj.find('.js-booking-themecode');if(bookingConfig.length>0&&bookingConfigCode.length>0&&currencyCode.length>0&&bookingThemeCode.length>0){setTimeout(()=>{let countryCode=this.$obj.data('geolocation');if(countryCode){_processRegions(countryCode);}},1500);function _processRegions(countryCode){const regions={"us-canada":["US","CA"],"mexico":["MX"],"latin-america":["AR","BR","CL","CO","PE","VE","EC","BO","PY","UY","GY","SR","GF","BZ","CR","SV","GT","HN","NI","PA"],};function getRegion(countryCode){for(const[region,codes]of Object.entries(regions)){if(codes.includes(countryCode)){return region;}}
return"everywhere";}
switch(getRegion(countryCode)){case"us-canada":bookingConfig.val("DFT");bookingConfigCode.val("DFT");currencyCode.val("USD");themeCode.val("DFT");bookingThemeCode.val("DFT");break;case"mexico":bookingConfig.val("MEX");bookingConfigCode.val("MEX");currencyCode.val("MXN");localeCode.val("es-MX");themeCode.val("MEX");bookingThemeCode.val("MEX");break;case"latin-america":bookingConfig.val("LTM");bookingConfigCode.val("LTM");currencyCode.val("USD");localeCode.val("es-MX");themeCode.val("LTM");bookingThemeCode.val("LTM");break;case"everywhere":default:bookingConfig.val("INTL");bookingConfigCode.val("INTL");currencyCode.val("USD");themeCode.val("INTL");bookingThemeCode.val("INTL");break;}}}};